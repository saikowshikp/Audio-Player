<!DOCTYPE html>
<html>
<head>
    <title>Song Player</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>
    <h1>Audio Player</h1>
    
    <audio id="audioPlayer" controls>
        <source src="" type="audio/mpeg">
        Your browser does not support the audio element.
    </audio>

    <div class="song-info">
        <p>Currently Playing: <span id="currentSong">No song selected</span></p>
    </div>

    <div class="controls">
        <button onclick="playPrevious()">Previous</button>
        <button onclick="playNext()">Next</button>
        <button onclick="toggleShuffle()">Shuffle On/Off</button>
    </div>

    <div class="songs">
        {% for song in songs %}
            <button onclick="playSong('{{ song }}')" id="{{ song.replace('.mp3', '') }}">{{ song }}</button>
        {% endfor %}
    </div>

    <script>
        var currentSong = 0;
        var audio = document.getElementById('audioPlayer');
        var songsList = [
            {% for song in songs %}
            '{{ song }}',
            {% endfor %}
        ];
        var shuffledList = [...songsList];
        var isShuffleOn = false; // Shuffle status

        audio.addEventListener('ended', function() {
            if (isShuffleOn) {
                if (shuffledList.length > 0) {
                    if (shuffledList.length === 1) {
                        currentSong = 0;
                    } else {
                        currentSong = (currentSong + 1) % shuffledList.length;
                    }
                    var nextSong = shuffledList[currentSong];
                    audio.src = "static/music/" + nextSong;
                    audio.play();
                    document.getElementById('currentSong').innerText = nextSong;

                    var buttons = document.getElementsByClassName("songs")[0].getElementsByTagName("button");
                    for (var i = 0; i < buttons.length; i++) {
                        buttons[i].classList.remove("highlight");
                    }
                    document.getElementById(nextSong.replace('.mp3', '')).classList.add("highlight");
                }
            } else {
                if (songsList.length > 0) {
                    if (songsList.length === 1) {
                        currentSong = 0;
                    } else {
                        currentSong = (currentSong + 1) % songsList.length;
                    }
                    var nextSong = songsList[currentSong];
                    audio.src = "static/music/" + nextSong;
                    audio.play();
                    document.getElementById('currentSong').innerText = nextSong;

                    var buttons = document.getElementsByClassName("songs")[0].getElementsByTagName("button");
                    for (var i = 0; i < buttons.length; i++) {
                        buttons[i].classList.remove("highlight");
                    }
                    document.getElementById(nextSong.replace('.mp3', '')).classList.add("highlight");
                }
            }
        });

        function playSong(song) {
            var index = songsList.indexOf(song);
            audio.src = "static/music/" + song;
            audio.play();
            currentSong = index;
            document.getElementById('currentSong').innerText = song;

            var buttons = document.getElementsByClassName("songs")[0].getElementsByTagName("button");
            for (var i = 0; i < buttons.length; i++) {
                buttons[i].classList.remove("highlight");
            }
            document.getElementById(song.replace('.mp3', '')).classList.add("highlight");

            shuffledList = [...songsList];
        }

        function playNext() {
            if (isShuffleOn) {
                if (shuffledList.length > 0) {
                    if (shuffledList.length === 1) {
                        currentSong = 0;
                    } else {
                        currentSong = (currentSong + 1) % shuffledList.length;
                    }
                    var nextSong = shuffledList[currentSong];
                    audio.src = "static/music/" + nextSong;
                    audio.play();
                    document.getElementById('currentSong').innerText = nextSong;

                    var buttons = document.getElementsByClassName("songs")[0].getElementsByTagName("button");
                    for (var i = 0; i < buttons.length; i++) {
                        buttons[i].classList.remove("highlight");
                    }
                    document.getElementById(nextSong.replace('.mp3', '')).classList.add("highlight");
                }
            } else {
                if (songsList.length > 0) {
                    if (songsList.length === 1) {
                        currentSong = 0;
                    } else {
                        currentSong = (currentSong + 1) % songsList.length;
                    }
                    var nextSong = songsList[currentSong];
                    audio.src = "static/music/" + nextSong;
                    audio.play();
                    document.getElementById('currentSong').innerText = nextSong;

                    var buttons = document.getElementsByClassName("songs")[0].getElementsByTagName("button");
                    for (var i = 0; i < buttons.length; i++) {
                        buttons[i].classList.remove("highlight");
                    }
                    document.getElementById(nextSong.replace('.mp3', '')).classList.add("highlight");
                }
            }
        }

        function playPrevious() {
            if (isShuffleOn) {
                if (shuffledList.length > 0) {
                    if (shuffledList.length === 1) {
                        currentSong = 0;
                    } else {
                        currentSong = (currentSong - 1 + shuffledList.length) % shuffledList.length;
                    }
                    var prevSong = shuffledList[currentSong];
                    audio.src = "static/music/" + prevSong;
                    audio.play();
                    document.getElementById('currentSong').innerText = prevSong;

                    var buttons = document.getElementsByClassName("songs")[0].getElementsByTagName("button");
                    for (var i = 0; i < buttons.length; i++) {
                        buttons[i].classList.remove("highlight");
                    }
                    document.getElementById(prevSong.replace('.mp3', '')).classList.add("highlight");
                }
            } else {
                if (songsList.length > 0) {
                    if (songsList.length === 1) {
                        currentSong = 0;
                    } else {
                        currentSong = (currentSong - 1 + songsList.length) % songsList.length;
                    }
                    var prevSong = songsList[currentSong];
                    audio.src = "static/music/" + prevSong;
                    audio.play();
                    document.getElementById('currentSong').innerText = prevSong;

                    var buttons = document.getElementsByClassName("songs")[0].getElementsByTagName("button");
                    for (var i = 0; i < buttons.length; i++) {
                        buttons[i].classList.remove("highlight");
                    }
                    document.getElementById(prevSong.replace('.mp3', '')).classList.add("highlight");
                }
            }
        }

        function toggleShuffle() {
            isShuffleOn = !isShuffleOn;
            var shuffleButton = document.getElementsByTagName('button')[2];

            if (isShuffleOn) {
                shuffleButton.innerText = 'Shuffle Off';
            } else {
                shuffleButton.innerText = 'Shuffle On';
                shuffledList = [...songsList];
            }
        }
    </script>
</body>
</html>
